<!doctype html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>SMIv2 For NETCONF (draft 0.1)</title>
    <link rel="stylesheet" href="/css/ncx.css" type="text/css"/>
  </head>
<body>

<p>
<a href="index.html">NCX Home</a>
</p>

<h1 align="center">SMIv2 For NETCONF</h1>

<p>Contents:</p>

<ul>
<li><a href="#SMI_Mapping">Overview</a></li>
</ul>

<h1><a name="SMI_Mapping">Overview</a></h1>

<p>
[Note: This specification is preliminary and incomplete.]
</p>

<p>
In order to make SNMP agent-based device information
available to a NETCONF manager, some sort of internal
or proxy-based inter-connect between the NETCONF agent
and the SNMP agent is likely to be required.
</p>

<p>
There are several factors to be considered, in order
to avoid manual conversion of every SMIv2 MIB module:
</p>

<ul>
<li>Data type translation and XML representation</li>
<li>Conceptual data structure translation</li>
<li>Conceptual data instance naming translation</li>
<li>Name Collision Proof Data Organization</li>
<li>NETCONF Protocol Operation Mappings</li>
<li>Consideration of SMIv2 Conformance Macros</li>
<li>Consideration of data instances of type 'RowStatus'</li>
<li>Consideration of data instances of type 'InstancePointer'</li>
<li>Consideration of data instances of type 'StorageType'</li>
<li>Consideration of the MAX-ACCESS and MIN-ACCESS clauses</li>
<li>Consideration of the STATUS clause</li>
</ul>

<p>
The NCX module <a href="../ncx-modules/smi.ncx">smi.ncx</a>
contains SMIv2 data types and textual conventions, 
which can be imported and used within other modules.
</p>
    
<p>
The NCX module <a href="../ncx-modules/inetAddress.ncx">inetAddress.ncx</a>
contains SMIv2 InetAddress textual-conventions,
which can be imported and used within other modules.
</p>

<p>
This section defines the SMIv2 Naming to NCX Naming Mapping Algorithm.
Such an algorithm is needed to access SMIv2 data models through
the NETCONF protocol operations.  This mapping allows SMIv2 data
to be accessed within the NETCONF protocol such
that naming collisions are not possible.
</p>

<p>
Only SMIv2 OBJECT-TYPE, INDEX, and SEQUENCE macros are mapped
into NCX at this time.  An SMIv2 object name is mapped to NCX 
as follows:
</p>

<ul>
<li>Only MIB objects (scalars and tables) are accessible</li>
<li>The organization that published the SMIv2 MIB module 
    is mapped to the NCX owner. All objects under the 'mib-2'
    root are owned by 'ietf'.
</li>
<li>The application name 'snmpdata' is assigned,
    and therefore the application header root is &lt;snmpdata&gt;.
</li>
<li>The name of the MIB module (e.g., IF-MIB) is used as the
    parameter set name. For example, the parameter set
    header node would be defined as &lt;IF-MIB&gt;.
</li>
<li>For scalar objects, the name of scalar OBJECT-TYPE macro is used 
    as the parameter name (e.g., ifNumber)
</li>
<li>For tabular objects, the name of the table OBJECT-TYPE macro is used
    as the parameter name (e.g., ifTable)
</li>
<li>The simplest approach to convert an SMIv2 table:
  <ul>
  <li>The table name (e.g. ifTable) becomes the parameter name,
      and its data type is 'container'</li>
  <li>The table entry name (e.g. ifEntry) becomes the container
      contents, and its data type is 'struct'.</li>
  <li>To identify a specific row in a table, the INDEX clause 
      for the table is translated to an Xpath
      'and' expression, and placed in the element for
      the container contents.</li>
  <li>For example, 'ifEntry.4' is specified as:<br/>
      <b>/snmpdata/IF-MIB/ifTable/ifEntry[ifIndex=4]</b></li>
  </ul>
</li>
<li>The &lt;snmpdata&gt; root supports the following XML attributes:
  <ul>
  <li><b>context</b> -- SNMP Context ID of desired context</li>
  <li><b>snmpEngineId</b> -- SNMP Engine ID of desired SNMP engine</li>
  </ul>
</li>
<li>An agent that supports multiple SNMP Contexts will not ignore
    the 'context' attribute, and the protocol operation will
    only affect conceptual object instances in the specified SNMP Context
</li>
<li>For Xpath filter expressions, each INDEX clause 
    component is encoded into an NCX Instance Identifier
    by forming an Xpath 'and' expression, from left to right,
    in the same order as defined in the SMIv2 INDEX clause
</li>
<li>
The INDEX node components must be encoded as XML child nodes
in subtree filter expressions
</li>
<li>
MIB objects which have a conceptual data type of <b>RowStatus</b> 
or <b>StorageType</b> are not needed in NETCONF and these
objects may be discarded in the SMIv2 to NCX translation.
If they are present, they must have a max-access of read-only.
</li>
<li>
MIB objects which have an ASN.1 type OBJECT IDENTIFIER
should be translated to NCX Instance Identifier format
when returned within the &lt;snmpdata&gt; data model.
</li>
</ul>

<p>
The following 'Interfaces module' shows how the SMIv2 data
in the SMIv2 IF-MIB would conceptually be defined in NCX:
<pre>

    ncx-module interfaces {
      header {
        description 
          "NCX Interfaces Data Model
           So far, just ifTable from IF-MIB is added;
          ";
        version 0.2;
        owner ncx;
        application snmpdata;
        last-update "2007-03-30";
      }
    
      imports {
        import smi;
        import inetAddress;
        # import ianaTypes { IANAifType };
      }
    
      definitions {
    
        type InterfaceIndexOrZero {
          description
                "This textual convention is an extension of the
                InterfaceIndex convention.  The latter defines a greater
                than zero value used to identify an interface or interface
                sub-layer in the managed system.  This extension permits the
                additional value of zero.  the value zero is object-specific
                and must therefore be defined as part of the description of
                any object which uses this syntax.  Examples of the usage of
                zero might include situations where interface was unknown,
                or when none or all interfaces need to be referenced.";
          syntax {  Integer32 (0 .. 2147483647); }
          appinfo { display-hint "d"; }
        }
    
        type InterfaceIndex {
          description
            "A unique value, greater than zero, for each interface or
             interface sub-layer in the managed system.  It is
             recommended that values are assigned contiguously starting
             from 1.  The value for each interface sub-layer must remain
             constant at least from one re-initialization of the entity's
             network management system to the next re-initialization.";
          syntax { InterfaceIndexOrZero (1 .. ); }
        }
    
        # in order to give every parameter its own description, max-access
        # and appinfo clauses, each column in the ifTable contained in its 
        # own type definition
    
        # some objects are not defined as max-access read-only because
        # they should be writable, and are only read-only in the IF-MIB
        # due to conformance decisions
    
        type IfIndex {
          description
            "A unique value, greater than zero, for each interface.  It
             is recommended that values are assigned contiguously
             starting from 1.  The value for each interface sub-layer
             must remain constant at least from one re-initialization of
             the entity's network management system to the next re-
             initialization.";
           syntax { InterfaceIndex; }
           max-access read-only;
        }
    
        type IfDescr {
          description
            "A textual string containing information about the
             interface.  This string should include the name of the
             manufacturer, the product name and the version of the
             interface hardware/software.";
           syntax { DisplayString (0..255); }
        }
    
        type IfType {
          description
            "The type of interface.  Additional values for ifType are
             assigned by the Internet Assigned Numbers Authority (IANA),
             through updating the syntax of the IANAifType textual
             convention.";
           # syntax { IANAifType; }   # don't have ianaTypes module done yet
           syntax { string (1 .. 255); }
         }
          
        type IfMtu {
          description
            "The size of the largest packet which can be sent/received
             on the interface, specified in octets.  For interfaces that
             are used for transmitting network datagrams, this is the
             size of the largest network datagram that can be sent on the
             interface.";
          syntax { Integer32; }
        }
    
        # rest of ifEntry removed to shorten the example
    
        type IfEntry {
          description    
            "An entry containing management information applicable to a
             particular interface.";
          syntax {
            struct {
               IfIndex                 ifIndex;
               IfDescr                 ifDescr;
               IfType                  ifType;
               IfMtu                   ifMtu;
               IfSpeed                 ifSpeed;
               IfPhysAddress           ifPhysAddress;
               IfAdminStatus           ifAdminStatus;
               IfOperStatus            ifOperStatus;
               IfLastChange            ifLastChange;
               IfInOctets              ifInOctets;
               IfInUcastPkts           ifInUcastPkts;
               IfInNUcastPkts          ifInNUcastPkts;   # deprecated
               IfInDiscards            ifInDiscards;
               IfInErrors              ifInErrors;
               IfInUnknownProtos       ifInUnknownProtos;
               IfOutOctets             ifOutOctets;
               IfOutUcastPkts          ifOutUcastPkts;
               IfOutNUcastPkts         ifOutNUcastPkts;  # deprecated
               IfOutDiscards           ifOutDiscards;
               IfOutErrors             ifOutErrors;
               IfOutQLen               ifOutQLen;        # deprecated
               IfSpecific              ifSpecific;       # deprecated
            }
          }
        }
    
        type IfTable {
          syntax {
            container [ifEntry.ifIndex] {
              IfEntry    ifEntry;
            }
          }
        }
    
        parmset IF-MIB {
          description
             "Parameters for Network interfaces.";
          order strict;
          parms {
            parm ifNumber {
              description
                "The number of network interfaces (regardless of their
                 current state) present on this system.";
              type Integer32;
              max-access read-only;
            }
    
            parm ifTableLastChange {
              description
                "The value of sysUpTime at the time of the last creation or
                deletion of an entry in the ifTable.  If the number of
                entries has been unchanged since the last re-initialization
                of the local network management subsystem, then this object
                contains a zero value.";
              type TimeTicks;
              max-access read-only;
            }
    
            parm ifTable {
              description "NCX Interfaces Configuration Table";
              type IfEntry;
              usage mandatory;
            }
          }
        }
    
      }   # end definitions
    }  # end module
    
</pre>

<p>
The following example shows how the IF-MIB might be accessed
with a NETCONF &lt;get&gt; operation:
</p>

<pre>

    # Example &lt;rpc-reply&gt; with data from the IF-MIB
    # In this example, the a &lt;get&gt; request for the entire
    # &lt;IF-MIB&gt; element
    #
    # The application is 'snmpdata'
    # The parameter set is 'IF-MIB'


    &lt;rpc message-id="7" xmlns="urn:ietf:params:xml:ns:netconf:base:1.0"&gt;
      &lt;get&gt;
        &lt;filter type="subtree"&gt;
          &lt;snmpdata xmlns="http://www.ietf.org/SMIv2"&gt;
            &lt;IF-MIB xmlns="http://www.ietf.org/SMIv2/IF-MIB"/&gt;
          &lt;/snmpdata&gt;
        &lt;/filter&gt;
      &lt;/get&gt;
    &lt;/rpc&gt;


    &lt;rpc-reply message-id="701" xmlns="urn:ietf:params:xml:ns:netconf:base:1.0"&gt;
      &lt;data&gt;
        &lt;snmpdata xmlns="http://www.ietf.org/SMIv2"&gt;
          &lt;IF-MIB xmlns="http://www.ietf.org/SMIv2/IF-MIB"&gt;
            &lt;ifNumber&gt;3&lt;/ifNumber&gt;
            &lt;ifTableLastChange&gt;176443&lt;/ifTableLastChange&gt;
            &lt;ifTable&gt;
              &lt;ifEntry&gt;
                &lt;ifIndex&gt;1&lt;/ifIndex&gt;
                &lt;ifDescr&gt;Ethernet0&lt;/ifDescr&gt;
                &lt;ifType&gt;xx&lt;/ifType&gt;
                &lt;ifMtu&gt;1500&lt;/ifMtu&gt;
                # ...... rest of ifEntry 
              &lt;/ifEntry&gt;
              &lt;ifEntry&gt;
                &lt;ifIndex&gt;2&lt;/ifIndex&gt;
                &lt;ifDescr&gt;Ethernet1&lt;/ifDescr&gt;
                &lt;ifType&gt;xx&lt;/ifType&gt;
                &lt;ifMtu&gt;1500&lt;/ifMtu&gt;
                # ...... rest of ifEntry 
              &lt;/ifEntry&gt;
              &lt;ifEntry&gt;
                &lt;ifIndex&gt;3&lt;/ifIndex&gt;
                &lt;ifDescr&gt;Ethernet0&lt;/ifDescr&gt;
                &lt;ifType&gt;xx&lt;/ifType&gt;
                &lt;ifMtu&gt;1500&lt;/ifMtu&gt;
                # ...... rest of ifEntry 
              &lt;/ifEntry&gt;
            &lt;/ifTable&gt;
          &lt;/IF-MIB&gt;
        &lt;/snmpdata&gt;
      &lt;/data&gt;
    &lt;/rpc-reply&gt;

</pre>

<hr/>
<p>
Copyright &copy; 2007 by Andy Bierman, All Rights Reserved.
</p>
<p>Last-Updated: 2007-06-09</p>
</body>
</html>

