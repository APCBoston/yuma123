# Makefile for NETCONF project
#  
# modules directory
#
# processes all the modules in this subtree
# For each YANG file in the subtree, generate
# an HTML and XSD file for that file in the directory
#
#    XSD: $TRUNK/ncorg/ncorg/static/xsd
#
#    HTML: $TRUNK/ncorg/ncorg/static/modules
#
# within the trunk subtree


############### SOURCE PROFILE ##############################

SUBDIR_NM=modules
YANGDUMP=../target/bin/yangdumpcode
SUBDIR_CPP=""
SUBTREE_PARMS=--subtree=./yang --subtree=./ietf --subtree=./netconfcentral

############### TARGET PROFILE ##############################

# copy modules to /usr/share/yuma
TOP_INSTALL = $(DESTDIR)/usr/share/yuma
INSTALL_TARGET=$(TOP_INSTALL)/modules

# setup files in ncorg WEB site
TROOT=$(HOME)/swdev/ncorg
TBASE=$(TROOT)/ncorg/ncorg/static
XSD_TARGET=$(TBASE)/xsd
COPY_TARGET=$(TBASE)/src
HTML_TARGET=$(TBASE)/modules
COOKEDHTML_TARGET=$(TBASE)/cookedmodules

SQLDB_TARGET=$(TROOT)/mysql/newmod.sql

WARNINGS=--warn-linelen=0 --warn-idlen=0 --log-level=warn

######################### MAKE RULES ######################

all: 

.PHONY: ncorg clean-install

ncorg: xsd html cookedhtml sqldb copy

xsd:
	if [ -d "$(TROOT)" ]; then\
	  $(YANGDUMP) --format=xsd $(SUBTREE_PARMS) --defnames=true \
	  --output=$(XSD_TARGET) --urlstart=/xsd $(WARNINGS); \
	fi

html:
	if [ -d "$(TROOT)" ]; then\
	  $(YANGDUMP) --format=html $(SUBTREE_PARMS) --defnames=true \
	  --output=$(HTML_TARGET) --html-div=true --html-toc=menu \
	  --urlstart=/modules --simurls=true $(WARNINGS); \
	fi

cookedhtml:
	if [ -d "$(TROOT)" ]; then\
	  $(YANGDUMP) --format=html $(SUBTREE_PARMS) --defnames=true \
	  --output=$(COOKEDHTML_TARGET) --html-div=true \
	  --html-toc=menu --urlstart=/modules --simurls=true \
	  --objview=cooked $(WARNINGS); \
	fi

sqldb:
	if [ -d "$(TROOT)" ]; then\
	  $(YANGDUMP) --format=sqldb $(SUBTREE_PARMS) \
	  --output=$(SQLDB_TARGET) --urlstart=/modules \
	  --simurls=true $(WARNINGS); \
	fi
copy:
	if [ -d "$(TROOT)" ]; then\
	  $(YANGDUMP) --format=copy $(SUBTREE_PARMS) --defnames=true \
	  --output=$(COPY_TARGET) $(WARNINGS); \
	fi

test:

ifdef SERVER
install:
	mkdir -p $(INSTALL_TARGET)
	mkdir -p $(INSTALL_TARGET)/netconfcentral
	cp netconfcentral/netconfd.yang $(INSTALL_TARGET)/netconfcentral
	cp netconfcentral/yuma-mysession.yang $(INSTALL_TARGET)/netconfcentral
	cp netconfcentral/yuma-interfaces.yang $(INSTALL_TARGET)/netconfcentral
	cp netconfcentral/yuma-mysession.yang $(INSTALL_TARGET)/netconfcentral
	cp netconfcentral/yuma-proc.yang $(INSTALL_TARGET)/netconfcentral
	cp netconfcentral/yuma-system.yang $(INSTALL_TARGET)/netconfcentral
else
ifdef CLIENT
install:
	mkdir -p $(INSTALL_TARGET)
	mkdir -p $(INSTALL_TARGET)/netconfcentral
	cp netconfcentral/yangcli.yang $(INSTALL_TARGET)/netconfcentral
	cp netconfcentral/yangdump.yang $(INSTALL_TARGET)/netconfcentral
	cp netconfcentral/yangdiff.yang $(INSTALL_TARGET)/netconfcentral
else
ifdef SHLIBS
install:
	mkdir -p $(INSTALL_TARGET)
	mkdir -p $(INSTALL_TARGET)/netconfcentral
	mkdir -p $(INSTALL_TARGET)/ietf
	mkdir -p $(INSTALL_TARGET)/yang
	mkdir -p $(INSTALL_TARGET)/test
	cp ietf/*.yang $(INSTALL_TARGET)/ietf
	cp yang/*.yang $(INSTALL_TARGET)/yang
	cp test/*.yang $(INSTALL_TARGET)/test
	cp netconfcentral/toaster.yang $(INSTALL_TARGET)/netconfcentral
	cp netconfcentral/yuma-nacm.yang $(INSTALL_TARGET)/netconfcentral
	cp netconfcentral/yuma-app-common.yang $(INSTALL_TARGET)/netconfcentral
	cp netconfcentral/yuma-ncx.yang $(INSTALL_TARGET)/netconfcentral
	cp netconfcentral/yuma-types.yang $(INSTALL_TARGET)/netconfcentral
	cp netconfcentral/yuma-xsd.yang $(INSTALL_TARGET)/netconfcentral
	cp netconfcentral/yuma-netconf.yang $(INSTALL_TARGET)/netconfcentral
else
ifdef DEVELOPER
install:
else
install:
	mkdir -p $(INSTALL_TARGET)
	mkdir -p $(INSTALL_TARGET)/netconfcentral
	mkdir -p $(INSTALL_TARGET)/ietf
	mkdir -p $(INSTALL_TARGET)/yang
	mkdir -p $(INSTALL_TARGET)/test
	cp ietf/*.yang $(INSTALL_TARGET)/ietf
	cp yang/*.yang $(INSTALL_TARGET)/yang
	cp test/*.yang $(INSTALL_TARGET)/test
	cp netconfcentral/*.yang $(INSTALL_TARGET)/netconfcentral
endif
endif
endif
endif


clean-install:
	rm -rf $(INSTALL_TARGET)/*
	mkdir -p $(INSTALL_TARGET)
	mkdir -p $(INSTALL_TARGET)/ietf
	mkdir -p $(INSTALL_TARGET)/netconfcentral
	mkdir -p $(INSTALL_TARGET)/yang
	mkdir -p $(INSTALL_TARGET)/test
	cp ietf/*.yang $(INSTALL_TARGET)/ietf
	cp netconfcentral/*.yang $(INSTALL_TARGET)/netconfcentral
	cp yang/*.yang $(INSTALL_TARGET)/yang
	cp test/*.yang $(INSTALL_TARGET)/test

.PHONY: clean-install

uninstall:
ifndef DEVELOPER
	rm -rf $(INSTALL_TARGET)
endif

clean:

superclean:

distclean: uninstall

# prevent the make program from choking on all the symbols
# that get generated from autogenerated make rules
.NOEXPORT:
