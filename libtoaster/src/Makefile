# Makefile for Yuma Server Instrumentation Library
#  

############### SOURCE PROFILE ##############################

SUBDIR_NM=toaster

SUBDIR_CPP=

############### TARGET PROFILE ##############################

TARGET=../bin

LIB_INST=../lib

WORK_INST=../../netconf/target/lib

REAL_INST=$(DESTDIR)/usr/lib/yuma


#################### MAKE RULES ########################

all: sil_dummy sil_lib

#################### PLATFORM DEFINITIONS ############
include ../../netconf/src/platform/platform.profile.sil

################ DEPENDENCIES #########################
# depend rule must be included after the 'all' make rule

include ../../netconf/src/platform/platform.profile.depend


test:

install:
	install $(LIB_INST)/lib$(SUBDIR_NM).$(LIBSUFFIX) $(REAL_INST)

sil_lib: $(LIB_INST)/lib$(SUBDIR_NM).$(LIBSUFFIX)

# this dummy rule keeps make from deleting the $(OBJS) as
# intermediate files
sil_dummy: dependencies $(OBJS)

clean:
	rm -f $(OBJS) $(LIB_INST)/lib$(SUBDIR_NM).*

superclean:
	rm -f *~  $(DEPS) dependencies $(OBJS) \
	$(LIB_INST)/lib$(SUBDIR_NM).*

$(LIB_INST)/lib$(SUBDIR_NM).so: $(OBJS)
	gcc -shared -rdynamic -Wl,-soname,lib$(SUBDIR_NM).so -o $@ $(OBJS) -ldl

#	gcc -shared -Wl,-soname,libtoaster.so -o $@ $(OBJS) -lc

$(LBASE)/lib$(SUBDIR_NM).dylib: $(OBJS)
	gcc -shared -dynamiclib -std=gnu99 -current_version 1.0 \
	-undefined dynamic_lookup \
	-o $@ -install_name lib$(SUBDIR_NM).dylib $(OBJS) -lxml2

code:
	yangdump format=h indent=4 module=$(SUBDIR_NM) output=$(SUBDIR_NM).h
	yangdump format=c indent=4 module=$(SUBDIR_NM) output=$(SUBDIR_NM).c


# prevent the make program from choking on all the symbols
# that get generated from autogenerated make rules
.NOEXPORT:

include dependencies
